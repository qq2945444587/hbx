{"version":3,"sources":["uni-app:///shopro/pay/index.js"],"names":["ShoproPay","payment","order","orderType","platform","$platform","get","payMehod","getPayMethod","payMethod","wxOfficialAccountPay","copyPayLink","walletPay","wxMiniProgramPay","wechatPay","aliPay","wechatWapPay","goToPayLink","that","Promise","resolve","reject","params","order_sn","uni","getStorageSync","openid","$http","then","res","code","data","showModal","title","content","success","confirm","wechat","bind","prepay","result","wxsdk","wxpay","pay_data","errMsg","payResult","url","match","reg","RegExp","newUrl","replace","domain","store","getters","initShop","encodeURIComponent","id","window","location","href","requestPayment","provider","fail","err","console","log","confirmText","setClipboardData","$u","toast","orderInfo","JSON","parse","resultType","$Router","path","query","orderId","type","payState"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;AAIA;AACA;AAGA;AACA;AAA0C;AAAA;AAE1C;AACA;AACA;AACA;AACA;AACA;AACA;AANA,IAQqBA,SAAS;EAG7B;EACA;EACA;EACA;;EAGA,mBAAYC,OAAO,EAAEC,KAAK,EAAEC,SAAS,EAAE;IAAA;IACtC,IAAI,CAACF,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACC,KAAK,GAAGA,KAAK;IAClB,IAAI,CAACC,SAAS,GAAGA,SAAS;IAC1B,IAAI,CAACC,QAAQ,GAAGC,iBAAS,CAACC,GAAG,EAAE;IAC/B,IAAIC,QAAQ,GAAG,IAAI,CAACC,YAAY,EAAE;IAClCD,QAAQ,EAAE;EAEX;EAAC;IAAA;IAAA,OAED,wBAAe;MAAA;MACd,IAAIE,SAAS,GAAG;QACf,mBAAmB,EAAE;UACpB,QAAQ,EAAE,kBAAM;YACf,KAAI,CAACC,oBAAoB,EAAE;UAC5B,CAAC;UACD,QAAQ,EAAE,kBAAM;YACf,KAAI,CAACC,WAAW,EAAE;UACnB,CAAC;UACD,QAAQ,EAAE,kBAAM;YACf,KAAI,CAACC,SAAS,EAAE;UACjB;QACD,CAAC;QACD,eAAe,EAAE;UAChB,QAAQ,EAAE,kBAAM;YACf,KAAI,CAACC,gBAAgB,EAAE;UACxB,CAAC;UACD,QAAQ,EAAE,kBAAM;YACf,KAAI,CAACF,WAAW,EAAE;UACnB,CAAC;UACD,QAAQ,EAAE,kBAAM;YACf,KAAI,CAACC,SAAS,EAAE;UACjB;QACD,CAAC;QACD,KAAK,EAAE;UACN,QAAQ,EAAE,kBAAM;YACf,KAAI,CAACE,SAAS,EAAE;UACjB,CAAC;UACD,QAAQ,EAAE,kBAAM;YACf,KAAI,CAACC,MAAM,EAAE;UACd,CAAC;UACD,QAAQ,EAAE,kBAAM;YACf,KAAI,CAACH,SAAS,EAAE;UACjB;QACD,CAAC;QACD,IAAI,EAAE;UACL,QAAQ,EAAE,kBAAM;YACf,KAAI,CAACI,YAAY,EAAE;UACpB,CAAC;UACD,QAAQ,EAAE,kBAAM;YACf,KAAI,CAACC,WAAW,EAAE;UACnB,CAAC;UACD,QAAQ,EAAE,kBAAM;YACf,KAAI,CAACL,SAAS,EAAE;UACjB;QACD;MACD,CAAC;MACD,OAAOH,SAAS,CAAC,IAAI,CAACL,QAAQ,CAAC,CAAC,IAAI,CAACH,OAAO,CAAC;IAC9C;;IAIA;EAAA;IAAA;IAAA,OACA,kBAAS;MAAA;MACR,IAAIiB,IAAI,GAAG,IAAI;MACf,OAAO,IAAIC,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM,EAAK;QACvC,IAAIH,IAAI,GAAG,MAAI;QACf,IAAII,MAAM,GAAG;UACZC,QAAQ,EAAEL,IAAI,CAAChB,KAAK,CAACqB,QAAQ;UAC7BtB,OAAO,EAAEiB,IAAI,CAACjB;QACf,CAAC;QACD,IAAIuB,GAAG,CAACC,cAAc,CAAC,QAAQ,CAAC,EAAE;UACjCH,MAAM,CAACI,MAAM,GAAGF,GAAG,CAACC,cAAc,CAAC,QAAQ,CAAC;QAC7C;QACA,IAAAE,cAAK,EAAC,cAAc,EAAEL,MAAM,EAAE,KAAK,CAAC,CAACM,IAAI,CAAC,UAAAC,GAAG,EAAI;UAChD,IAAIA,GAAG,CAACC,IAAI,KAAK,CAAC,EAAE;YACnBD,GAAG,CAACE,IAAI,KAAK,WAAW,GACvBP,GAAG,CAACQ,SAAS,CAAC;cACbC,KAAK,EAAE,MAAM;cACbC,OAAO,EAAE,eAAe;cACxBC,OAAO,EAAE,iBAASN,GAAG,EAAE;gBACtB,IAAIA,GAAG,CAACO,OAAO,EAAE;kBAChBC,eAAM,CAACC,IAAI,EAAE;gBACd;cACD;YACD,CAAC,CAAC,GACFlB,OAAO,CAACS,GAAG,CAAC;UAEd;QACD,CAAC,CAAC;MACH,CAAC,CAAC;IACH;;IAGA;EAAA;IAAA;IAAA;MAAA,oGACA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACKX,IAAI,GAAG,IAAI;gBAAA;gBAAA,OACI,IAAI,CAACqB,MAAM,EAAE;cAAA;gBAA5BC,MAAM;gBACVC,KAAK,CAACC,KAAK,CAACF,MAAM,CAACT,IAAI,CAACY,QAAQ,EAAE,UAACd,GAAG,EAAK;kBAC1CA,GAAG,CAACe,MAAM,IAAI,gBAAgB,GAAG1B,IAAI,CAAC2B,SAAS,CAAC,SAAS,CAAC,GAAG3B,IAAI,CAAC2B,SAAS,CAAC,MAAM,CAAC;gBACpF,CAAC,CAAC;cAAC;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA,CAEH;MAAA;QAAA;MAAA;MAAA;IAAA,IAED;EAAA;IAAA;IAAA;MAAA,4FACA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACK3B,IAAI,GAAG,IAAI;gBAAA;gBAAA,OACI,IAAI,CAACqB,MAAM,EAAE;cAAA;gBAA5BC,MAAM;gBACV,IAAIA,MAAM,CAACV,IAAI,KAAK,CAAC,EAAE;kBAClBgB,GAAG,GAAGN,MAAM,CAACT,IAAI,CAACY,QAAQ,CAACI,KAAK,CAAC,gBAAgB,CAAC;kBAClDC,GAAG,GAAG,IAAIC,MAAM,CAAC,OAAO,EAAE,GAAG,CAAC,EAAC;kBAC/BC,MAAM,GAAGJ,GAAG,CAAC,CAAC,CAAC,CAACK,OAAO,CAACH,GAAG,EAAE,GAAG,CAAC;kBACjCI,MAAM,GAAGC,cAAK,CAACC,OAAO,CAACC,QAAQ,CAACH,MAAM,EAAE;kBACxC9B,MAAM,GAAGkC,kBAAkB,WAC3BJ,MAAM,gDAAsClC,IAAI,CAAChB,KAAK,CAACuD,EAAE,mBAASvC,IAAI,CAACjB,OAAO,wBAAciB,IAAI,CAACf,SAAS,EAC7G;kBACDuD,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAGV,MAAM,GAAG,gBAAgB,GAAG5B,MAAM;gBAC1D;cAAC;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA,CACD;MAAA;QAAA;MAAA;MAAA;IAAA,IAED;EAAA;IAAA;IAAA;MAAA,gGACA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACKJ,IAAI,GAAG,IAAI;gBAAA;gBAAA,OACI,IAAI,CAACqB,MAAM,EAAE;cAAA;gBAA5BC,MAAM;gBACVhB,GAAG,CAACqC,cAAc;kBACjBC,QAAQ,EAAE;gBAAO,GACdtB,MAAM,CAACT,IAAI,CAACY,QAAQ;kBACvBR,OAAO,EAAE,iBAAAN,GAAG,EAAI;oBACfX,IAAI,CAAC2B,SAAS,CAAC,SAAS,CAAC;kBAC1B,CAAC;kBACDkB,IAAI,EAAE,cAAAC,GAAG,EAAI;oBACZC,OAAO,CAACC,GAAG,CAAC,WAAW,EAAEF,GAAG,CAAC;oBAC7BA,GAAG,CAACpB,MAAM,KAAK,4BAA4B,IAAI1B,IAAI,CAAC2B,SAAS,CAAC,MAAM,CAAC;kBACtE;gBAAC,GACA;cAAC;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA,CACH;MAAA;QAAA;MAAA;MAAA;IAAA,IAED;EAAA;IAAA;IAAA;MAAA,yFACA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACK3B,IAAI,GAAG,IAAI;gBAAA;gBAAA,OACI,IAAI,CAACqB,MAAM,EAAE;cAAA;gBAA5BC,MAAM;gBACVA,MAAM,CAACV,IAAI,KAAK,CAAC,IAAIZ,IAAI,CAAC2B,SAAS,CAAC,SAAS,CAAC;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA,CAC9C;MAAA;QAAA;MAAA;MAAA;IAAA,IAED;EAAA;IAAA;IAAA;MAAA,2FACA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACK3B,IAAI,GAAG,IAAI;gBAAA;gBAAA,OACI,IAAI,CAACqB,MAAM,EAAE;cAAA;gBAA5BC,MAAM;gBACV,IAAIA,MAAM,CAACV,IAAI,KAAK,CAAC,EAAE;kBACtB;kBACAN,GAAG,CAACQ,SAAS,CAAC;oBACbC,KAAK,EAAE,OAAO;oBACdC,OAAO,EAAE,YAAY;oBACrBiC,WAAW,EAAE,MAAM;oBACnBhC,OAAO,EAAE,iBAACN,GAAG,EAAK;sBACjB,IAAIA,GAAG,CAACO,OAAO,EAAE;wBAChBZ,GAAG,CAAC4C,gBAAgB,CAAC;0BACpBrC,IAAI,EAAES,MAAM,CAACT,IAAI,CAACY,QAAQ;0BAC1BR,OAAO,EAAE,iBAASJ,IAAI,EAAE;4BACvBb,IAAI,CAACmD,EAAE,CAACC,KAAK,CAAC,SAAS,CAAC;0BACzB;wBACD,CAAC,CAAC;sBACH;oBACD;kBACD,CAAC,CAAC;gBACH;cAAC;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA,CACD;MAAA;QAAA;MAAA;MAAA;IAAA,IAED;EAAA;IAAA;IAAA;MAAA,2FACA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACKpD,IAAI,GAAG,IAAI;gBAAA;gBAAA,OACI,IAAI,CAACqB,MAAM,EAAE;cAAA;gBAA5BC,MAAM;gBACV,IAAIA,MAAM,CAACV,IAAI,KAAK,CAAC,EAAE;kBACtB4B,MAAM,CAACC,QAAQ,GAAGnB,MAAM,CAACT,IAAI,CAACY,QAAQ;gBACvC;cAAC;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA,CACD;MAAA;QAAA;MAAA;MAAA;IAAA,IAED;EAAA;IAAA;IAAA;MAAA,sFACA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACKzB,IAAI,GAAG,IAAI;gBAAA;gBAAA,OACI,IAAI,CAACqB,MAAM,EAAE;cAAA;gBAA5BC,MAAM;gBACV,IAAIA,MAAM,CAACV,IAAI,KAAK,CAAC,EAAE;kBACtBN,GAAG,CAACqC,cAAc,CAAC;oBAClBC,QAAQ,EAAE,QAAQ;oBAClBS,SAAS,EAAE/B,MAAM,CAACT,IAAI,CAACY,QAAQ;oBAAE;oBACjCR,OAAO,EAAE,iBAAAN,GAAG,EAAI;sBACfX,IAAI,CAAC2B,SAAS,CAAC,SAAS,CAAC;oBAC1B,CAAC;oBACDkB,IAAI,EAAE,cAAAC,GAAG,EAAI;sBACZC,OAAO,CAACC,GAAG,CAAC,WAAW,EAAEF,GAAG,CAAC;sBAC7BA,GAAG,CAACpB,MAAM,KAAK,4BAA4B,IAAI1B,IAAI,CAAC2B,SAAS,CAAC,MAAM,CAAC;oBACtE;kBACD,CAAC,CAAC;gBACH;cAAC;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA,CACD;MAAA;QAAA;MAAA;MAAA;IAAA,IAED;EAAA;IAAA;IAAA;MAAA,yFACA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACK3B,IAAI,GAAG,IAAI;gBAAA;gBAAA,OACI,IAAI,CAACqB,MAAM,EAAE;cAAA;gBAA5BC,MAAM;gBACV,IAAIA,MAAM,CAACV,IAAI,KAAK,CAAC,EAAE;kBACtBN,GAAG,CAACqC,cAAc,CAAC;oBAClBC,QAAQ,EAAE,OAAO;oBACjBS,SAAS,EAAEC,IAAI,CAACC,KAAK,CAACjC,MAAM,CAACT,IAAI,CAACY,QAAQ,CAAC;oBAAE;oBAC7CR,OAAO,EAAE,iBAAAN,GAAG,EAAI;sBACfX,IAAI,CAAC2B,SAAS,CAAC,SAAS,CAAC;oBAC1B,CAAC;oBACDkB,IAAI,EAAE,cAAAC,GAAG,EAAI;sBACZA,GAAG,CAACpB,MAAM,KAAK,4BAA4B,IAAI1B,IAAI,CAAC2B,SAAS,CAAC,MAAM,CAAC;sBACrEoB,OAAO,CAACC,GAAG,CAAC,WAAW,EAAEF,GAAG,CAAC;oBAC9B;kBACD,CAAC,CAAC;gBACH;cAAC;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA,CACD;MAAA;QAAA;MAAA;MAAA;IAAA,IAGD;EAAA;IAAA;IAAA,OACA,mBAAUU,UAAU,EAAE;MACrB,IAAMxD,IAAI,GAAG,IAAI;MACjByD,cAAO,CAACxB,OAAO,CAAC;QACfyB,IAAI,EAAE,6BAA6B;QACnCC,KAAK,EAAE;UACNC,OAAO,EAAE5D,IAAI,CAAChB,KAAK,CAACuD,EAAE;UACtBsB,IAAI,EAAE7D,IAAI,CAACjB,OAAO;UAAE;UACpB+E,QAAQ,EAAEN,UAAU;UACpBvE,SAAS,EAAEe,IAAI,CAACf;QACjB;MACD,CAAC,CAAC;IACH;EAAC;EAAA;AAAA;AAAA,4B","file":"pages/order/common/vendor.js","sourcesContent":["import $http from '@/shopro/request/index'\r\n\r\n\r\n\r\nimport wechat from '@/shopro/wechat/wechat'\r\nimport {\r\n\trouter as $Router\r\n} from '@/shopro/router/index.js'\r\nimport store from '@/shopro/store';\r\nimport $platform from '@/shopro/platform';\r\n\r\n/**\r\n * 支付\r\n * \r\n * @param {String} payment = ['wechat','alipay','wallet']  \t- 支付方式\r\n * @param {Object} order = {}  \t\t\t\t\t\t\t\t- 订单详情\r\n * @param {String} orderType = ['goods','recharge'] \t\t- 订单类型\r\n */\r\n\r\nexport default class ShoproPay {\r\n\r\n\r\n\t//\t\t\t\t\t\twxOfficialAccount\t\t\twxMiniProgram\t\t\tApp\t\t\t\t\t\tH5\r\n\t// \t\t\twechat\t\t\t公众号JSSDK支付\t\t\t\t小程序支付\t\t\t微信开放平台支付\t\t\tH5网页支付\r\n\t//\t\t\talipay\t\t\t复制网址\t\t\t\t\t\t复制网址\t\t\t\t支付宝开放平台支付\t\t    直接跳转链接\r\n\t// \t\t\twallet\t\t\tv\t\t\t\t\t\t\tv\t\t\t\t\tv\t\t\t\t\t\tv\r\n\r\n\r\n\tconstructor(payment, order, orderType) {\r\n\t\tthis.payment = payment;\r\n\t\tthis.order = order;\r\n\t\tthis.orderType = orderType;\r\n\t\tthis.platform = $platform.get();\r\n\t\tlet payMehod = this.getPayMethod();\r\n\t\tpayMehod();\r\n\r\n\t}\r\n\r\n\tgetPayMethod() {\r\n\t\tvar payMethod = {\r\n\t\t\t'wxOfficialAccount': {\r\n\t\t\t\t'wechat': () => {\r\n\t\t\t\t\tthis.wxOfficialAccountPay()\r\n\t\t\t\t},\r\n\t\t\t\t'alipay': () => {\r\n\t\t\t\t\tthis.copyPayLink()\r\n\t\t\t\t},\r\n\t\t\t\t'wallet': () => {\r\n\t\t\t\t\tthis.walletPay()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'wxMiniProgram': {\r\n\t\t\t\t'wechat': () => {\r\n\t\t\t\t\tthis.wxMiniProgramPay()\r\n\t\t\t\t},\r\n\t\t\t\t'alipay': () => {\r\n\t\t\t\t\tthis.copyPayLink()\r\n\t\t\t\t},\r\n\t\t\t\t'wallet': () => {\r\n\t\t\t\t\tthis.walletPay()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'App': {\r\n\t\t\t\t'wechat': () => {\r\n\t\t\t\t\tthis.wechatPay()\r\n\t\t\t\t},\r\n\t\t\t\t'alipay': () => {\r\n\t\t\t\t\tthis.aliPay()\r\n\t\t\t\t},\r\n\t\t\t\t'wallet': () => {\r\n\t\t\t\t\tthis.walletPay()\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\t'H5': {\r\n\t\t\t\t'wechat': () => {\r\n\t\t\t\t\tthis.wechatWapPay()\r\n\t\t\t\t},\r\n\t\t\t\t'alipay': () => {\r\n\t\t\t\t\tthis.goToPayLink()\r\n\t\t\t\t},\r\n\t\t\t\t'wallet': () => {\r\n\t\t\t\t\tthis.walletPay()\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t}\r\n\t\treturn payMethod[this.platform][this.payment];\r\n\t}\r\n\r\n\r\n\r\n\t// 预支付\r\n\tprepay() {\r\n\t\tlet that = this;\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet that = this;\r\n\t\t\tlet params = {\r\n\t\t\t\torder_sn: that.order.order_sn,\r\n\t\t\t\tpayment: that.payment\r\n\t\t\t}\r\n\t\t\tif (uni.getStorageSync('openid')) {\r\n\t\t\t\tparams.openid = uni.getStorageSync('openid');\r\n\t\t\t}\r\n\t\t\t$http('money.prepay', params, '支付中').then(res => {\r\n\t\t\t\tif (res.code === 1) {\r\n\t\t\t\t\tres.data === 'no_openid' ?\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\ttitle: '微信支付',\r\n\t\t\t\t\t\t\tcontent: '请先绑定微信再使用微信支付',\r\n\t\t\t\t\t\t\tsuccess: function(res) {\r\n\t\t\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t\t\twechat.bind();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t}) :\r\n\t\t\t\t\t\tresolve(res);\r\n\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t});\r\n\t}\r\n\r\n\r\n\t// 微信H5支付\r\n\tasync wxOfficialAccountPay() {\r\n\t\tlet that = this;\r\n\t\tlet result = await this.prepay();\r\n\t\twxsdk.wxpay(result.data.pay_data, (res) => {\r\n\t\t\tres.errMsg == \"chooseWXPay:ok\" ? that.payResult('success') : that.payResult('fail')\r\n\t\t});\r\n\r\n\t}\r\n\r\n\t//浏览器微信支付\r\n\tasync wechatWapPay() {\r\n\t\tlet that = this;\r\n\t\tlet result = await this.prepay();\r\n\t\tif (result.code === 1) {\r\n\t\t\tvar url = result.data.pay_data.match(/url\\=\\'(\\S*)\\'/);\r\n\t\t\tlet reg = new RegExp('&amp;', 'g') //g代表全部\r\n\t\t\tlet newUrl = url[1].replace(reg, '&');\r\n\t\t\tlet domain = store.getters.initShop.domain; //域名需要https\r\n\t\t\tlet params = encodeURIComponent(\r\n\t\t\t\t`${domain}pages/order/payment/result?orderId=${that.order.id}&type=${that.payment}&orderType=${that.orderType}`\r\n\t\t\t)\r\n\t\t\twindow.location.href = newUrl + '&redirect_url=' + params;\r\n\t\t}\r\n\t}\r\n\r\n\t// 微信小程序支付\r\n\tasync wxMiniProgramPay() {\r\n\t\tlet that = this;\r\n\t\tlet result = await this.prepay();\r\n\t\tuni.requestPayment({\r\n\t\t\tprovider: 'wxpay',\r\n\t\t\t...result.data.pay_data,\r\n\t\t\tsuccess: res => {\r\n\t\t\t\tthat.payResult('success')\r\n\t\t\t},\r\n\t\t\tfail: err => {\r\n\t\t\t\tconsole.log('支付取消或者失败:', err);\r\n\t\t\t\terr.errMsg !== \"requestPayment:fail cancel\" && that.payResult('fail')\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t// 余额支付\r\n\tasync walletPay() {\r\n\t\tlet that = this;\r\n\t\tlet result = await this.prepay();\r\n\t\tresult.code === 1 && that.payResult('success')\r\n\t}\r\n\r\n\t// 支付宝复制链接支付\r\n\tasync copyPayLink() {\r\n\t\tlet that = this;\r\n\t\tlet result = await this.prepay();\r\n\t\tif (result.code === 1) {\r\n\t\t\t//引入showModal 点击确认 复制链接；\r\n\t\t\tuni.showModal({\r\n\t\t\t\ttitle: '支付宝支付',\r\n\t\t\t\tcontent: '复制链接到外部浏览器',\r\n\t\t\t\tconfirmText: '复制链接',\r\n\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\tuni.setClipboardData({\r\n\t\t\t\t\t\t\tdata: result.data.pay_data,\r\n\t\t\t\t\t\t\tsuccess: function(data) {\r\n\t\t\t\t\t\t\t\tthat.$u.toast('已复制到剪切板');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\t// 支付链接\r\n\tasync goToPayLink() {\r\n\t\tlet that = this;\r\n\t\tlet result = await this.prepay();\r\n\t\tif (result.code === 1) {\r\n\t\t\twindow.location = result.data.pay_data;\r\n\t\t}\r\n\t}\r\n\r\n\t// 支付宝支付\r\n\tasync aliPay() {\r\n\t\tlet that = this;\r\n\t\tlet result = await this.prepay();\r\n\t\tif (result.code === 1) {\r\n\t\t\tuni.requestPayment({\r\n\t\t\t\tprovider: 'alipay',\r\n\t\t\t\torderInfo: result.data.pay_data, //支付宝订单数据\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tthat.payResult('success')\r\n\t\t\t\t},\r\n\t\t\t\tfail: err => {\r\n\t\t\t\t\tconsole.log('支付取消或者失败:', err);\r\n\t\t\t\t\terr.errMsg !== \"requestPayment:fail cancel\" && that.payResult('fail')\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t// 微信支付\r\n\tasync wechatPay() {\r\n\t\tlet that = this;\r\n\t\tlet result = await this.prepay();\r\n\t\tif (result.code === 1) {\r\n\t\t\tuni.requestPayment({\r\n\t\t\t\tprovider: 'wxpay',\r\n\t\t\t\torderInfo: JSON.parse(result.data.pay_data), //微信订单数据(官方说是string。实测为object)\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tthat.payResult('success')\r\n\t\t\t\t},\r\n\t\t\t\tfail: err => {\r\n\t\t\t\t\terr.errMsg !== \"requestPayment:fail cancel\" && that.payResult('fail')\r\n\t\t\t\t\tconsole.log('支付取消或者失败:', err);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t// 支付结果跳转,success:成功，fail:失败\r\n\tpayResult(resultType) {\r\n\t\tconst that = this;\r\n\t\t$Router.replace({\r\n\t\t\tpath: '/pages/order/payment/result',\r\n\t\t\tquery: {\r\n\t\t\t\torderId: that.order.id,\r\n\t\t\t\ttype: that.payment, //重新支付的时候使用\r\n\t\t\t\tpayState: resultType,\r\n\t\t\t\torderType: that.orderType\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n}\r\n"],"sourceRoot":""}